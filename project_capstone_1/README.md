# ML Zoomcamp Capstone 1 Project

## Problem definition: Real driving cycles data on an electric vehicle battery
High-voltage batteries in battery electric vehicles face significant load fluctuations due to driving behavior. This dynamic performance of the powertrain is contrasted by the almost constant load of the auxiliary consumers. The highest auxiliary consumption is generated by the heating and air conditioning system, which decreases the vehicles range significantly. Prediction of battery temperature could optimize power consumption and improve vehicle range prediction.

The measurement data is divided into two categories. Category A was recorded in summer and does not contain all measured data due to trouble with the measurement system. Category B was recorded in winter and is consistent. For simplicity purpose only one trip data used in this project for model traing.
Dataset source: [BATTERY AND HEATING DATA IN REAL DRIVING CYCLES (Kaggle)](https://www.kaggle.com/datasets/atechnohazard/battery-and-heating-data-in-real-driving-cycles)


## Repository structure
- **EDA.ipynb**: Jupyter notebooks with EDA and experiments with models
- **train.py**: Automated scripts to train model and save artifacts localy
- **app.py**: Prediction endpoint using Flask
- **test_app.py**: Script to test endpoint
- **Dockerfile**: Docker file
- **docker_entrypoint.sh**: Entrypoint in docker to run app
- **docker-compose.yml**: Docker Compose file


## Train model
Activate environment, install dependecies and run train pipeline

    virtualenv env
    source env/bin/activate
    pip install -r requirements.txt
    python3 train.py --data=<data_path>

_Don't forget to download dataset before!_

## Run Flask app

    export FLASK_APP=app.py
    export FLASK_RUN_PORT=8800
    flask run

Test endpoint:

    export FLASK_RUN_PORT=8800
    python3 test_app.py

Response format of endpoint:

    {
        'predictions': {<temperatures>}
    }


## Dockerize
Run just one simple command (be sure that train model before)

    docker compose up

## Run as service in `kubectl`

    kubectl apply -f deployment.yaml
    kind load docker-image battery-temp:latest
    kubectl apply -f service.yaml

Example:  
![alt text](https://i.ibb.co/Q9Y84dp/Screenshot-2022-12-22-023002.png)
